<!DOCTYPE html><html><head><meta charset="UTF-8"><meta name="viewport" content="width=device-width, initial-scale=1.0"><meta http-equiv="X-UA-Compatible" content="ie=edge"><title>徐海滨 | yaco无言</title><link rel="stylesheet" href="/blogs/css/index.css"><link rel="stylesheet" href="https://netdna.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css"><script src="/blogs/js/third-party/jquery.min.js">           </script><script src="/blogs/js/third-party/velocity.min.js">           </script><script src="/blogs/js/third-party/velocity.ui.min.js">           </script><script src="http://dn-lbstatics.qbox.me/busuanzi/2.3/busuanzi.pure.mini.js">           </script><link rel="icon" href="/blogs/img/favicon.ico"></head><body><nav id="nav-bar"><nav class="clear-fix" id="nav-container"><div class="pull-left" id="page-home"><a href="/blogs/">yaco无言</a></div><i class="fa fa-bars pull-right" id="toggle-nav" aria-hidden="true"></i><ul class="pull-right" id="navs"><li><a class="nav" href="/blogs/">首页</a></li><li><a class="nav" href="/blogs/categories">分类</a></li><li><a class="nav" href="/blogs/tags">标签</a></li><li><a class="nav" href="/blogs/about">关于</a></li></ul></nav></nav><header id="header-info"><div id="header-container"><div id="site-info"><div id="terminal-pl"><div id="top-bar"><ul id="control"><li class="btn"></li><li class="btn"></li><li class="btn"></li></ul><div id="file-path"><i class="fa fa-folder folder-ic" aria-hidden="true"></i> yaco 10 X 10</div></div><div id="code-pl">Last updated: 2018-04-24<br>yaco:~ Desktop$ <span class="code-pl-input">node home.js</span><br><br>> Blog's visitors<br><span id="busuanzi_container_site_uv">访问人数 <span class="code-pl-input" id="busuanzi_value_site_uv"> </span>&nbsp人</span><br><br>> Blog's hits<br><span id="busuanzi_container_site_pv">访问次数 <span class="code-pl-input" id="busuanzi_value_site_pv"> </span>&nbsp次</span></div></div></div></div></header><div id="content-outer"><div id="content-inner"><div class="recent-post-item"><a class="article-title" href="/blogs/pug如何加入畅言评论功能.html">pug添加畅言评论模块</a><time class="article-date"><i class="fa fa-calendar" aria-hidden="true"></i> 2018-03-27</time><div class="article-inner"><h2 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h2><p>小菜鸡前段时间尝试着用 <a href="https://hexo.io/" target="_blank" rel="noopener">Hexo</a> 建一个个人博客。 安装hexo过程很顺畅，没有遇到什么问题，但是如果你有hexo安装的其他问题可以去看这位 <a href="http://cherryblog.site/categories/Hexo%E5%BB%BA%E7%AB%99/" target="_blank" rel="noopener">小仙女</a> 写的很详细的教程。 相比之下我的教程内容不是很精细，但是如果你想少走弯路可以来瞅瞅。</p>
<h2 id="问题"><a href="#问题" class="headerlink" title="问题"></a>问题</h2><p>我用的是畅言来当评论后台，但是我在添加评论模块的时候遇到了棘手的问题 – &gt; 这个主题的语言 &gt; <a href="https://www.npmjs.com/package/pug" target="_blank" rel="noopener">Pug</a> 我不会，哈哈。其实就是把畅言的模块放到你想要的位置，然后配置<a href="http://changyan.kuaizhan.com/static/help/f-source-id.html" target="_blank" rel="noopener">SourceID</a>。但是由于语言不通，所以不能成功的设置 <a href="http://changyan.kuaizhan.com/static/help/f-source-id.html" target="_blank" rel="noopener">SourceID</a>。查到的资料也都是 <a href="http://theme-next.iissnan.com/" target="_blank" rel="noopener">Next</a> 主题相关的解决方案，而我的主题是Pug生成的。难道我要因为一个评论功能就换掉我精挑细选的主题么，当然不阔能。一番翻云覆雨之后我终于搞定了这个东西。<br><img src="http://p6a4c3kie.bkt.clouddn.com/image/yaco_blogs_comment.jpeg" alt="image"></p>
<h3 id="Pug"><a href="#Pug" class="headerlink" title="Pug"></a>Pug</h3><p>Pug的前身是jade，百度jade和Pug的教程都是一样的，它们的语法都很相近。</p>
<h3 id="SourceID"><a href="#SourceID" class="headerlink" title="SourceID"></a>SourceID</h3><p>SourceID 是文章的唯一标识符，用来区分的文章的评论。文章的唯一标识符可以根据文章的标题、发布时间或者文章链接来生成独一无二的哈希值， 如果你不想区分开可以不写。</p>
<h3 id="注册畅言"><a href="#注册畅言" class="headerlink" title="注册畅言"></a>注册畅言</h3><p>注册没什么难的地方，就是繁琐。我就不啰嗦了。</p>
<h3 id="安装畅言"><a href="#安装畅言" class="headerlink" title="安装畅言"></a>安装畅言</h3><p>在博客里面 <a href="http://changyan.kuaizhan.com/install/code/self-adaption" target="_blank" rel="noopener">安装畅言</a>，不要被这两个字困扰，其实是引入。畅言会自动给你生成相关代码，我用的是自适应版本，可以根据自己的需要去选择。<br>下面看代码 ：首先是布局的代码，将这段代码放在你想要显示评论的位置。一般都会放在文章的底部。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">&lt;!--PC和WAP自适应版--&gt;</span><br><span class="line">&lt;div id=&quot;SOHUCS&quot; sid=&quot;请将此处替换为配置SourceID的语句&quot; &gt;&lt;/div&gt;</span><br></pre></td></tr></table></figure>
<p>sid 的值就是 SourceID 就是用来区分文章评论的</p>
<p>然后是js部分</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">&lt;script type=&quot;text/javascript&quot;&gt; </span><br><span class="line">(function()&#123; </span><br><span class="line">var appid = &apos;xxxxxxxxxx&apos;; </span><br><span class="line">var conf = &apos;xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx&apos;; </span><br><span class="line">var width = window.innerWidth || document.documentElement.clientWidth; </span><br><span class="line">if (width &lt; 960) &#123; </span><br><span class="line">window.document.write(&apos;&lt;script id=&quot;changyan_mobile_js&quot; charset=&quot;utf-8&quot; type=&quot;text/javascript&quot; src=&quot;https://changyan.sohu.com/upload/mobile/wap-js/changyan_mobile.js?client_id=&apos; + appid + &apos;&amp;conf=&apos; + conf + &apos;&quot;&gt;&lt;\/script&gt;&apos;); &#125; else &#123; var loadJs=function(d,a)&#123;var c=document.getElementsByTagName(&quot;head&quot;)[0]||document.head||document.documentElement;var b=document.createElement(&quot;script&quot;);b.setAttribute(&quot;type&quot;,&quot;text/javascript&quot;);b.setAttribute(&quot;charset&quot;,&quot;UTF-8&quot;);b.setAttribute(&quot;src&quot;,d);if(typeof a===&quot;function&quot;)&#123;if(window.attachEvent)&#123;b.onreadystatechange=function()&#123;var e=b.readyState;if(e===&quot;loaded&quot;||e===&quot;complete&quot;)&#123;b.onreadystatechange=null;a()&#125;&#125;&#125;else&#123;b.onload=a&#125;&#125;c.appendChild(b)&#125;;loadJs(&quot;https://changyan.sohu.com/upload/changyan.js&quot;,function()&#123;window.changyan.api.config(&#123;appid:appid,conf:conf&#125;)&#125;); &#125; &#125;)(); &lt;/script&gt;</span><br></pre></td></tr></table></figure>
<h2 id="操作"><a href="#操作" class="headerlink" title="操作"></a>操作</h2><h3 id="新建模块"><a href="#新建模块" class="headerlink" title="新建模块"></a>新建模块</h3><p>一、新建评论模块文件</p>
<p>  路径： themes -&gt; terminal -&gt; layout -&gt; includes   在自己使用的主题下新建 comment.pug  如图：</p>
<p><img src="http://p6a4c3kie.bkt.clouddn.com/image/yaco_blogs_list.jpeg" alt="image"></p>
<p>  路径： themes -&gt; terminal -&gt; layout -&gt; source -&gt; js  下新建comment文件夹用来存放一系列的js文件 ： comment.js (畅言提供的js代码) common.js (畅言的配置) getHashCode.js (获取文章的独一无二的哈希值，作为 SourceID) </p>
<p><img src="http://p6a4c3kie.bkt.clouddn.com/image/yaco_blogs_list2.jpeg" alt="image"></p>
<p>二、加入评论模块</p>
<p>  在 comment.pug 加入代码</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">- var hash = page.title + page.date;</span><br><span class="line">div(id=&quot;SOHUCS&quot; hash=`$&#123;hash&#125;` sid=&quot;&quot;)</span><br><span class="line">each url in theme.comment.js</span><br><span class="line">  script(src=url)</span><br></pre></td></tr></table></figure>
<p>hash 是 根据文章的标题和文章的时间组合成的字符串 </p>
<p>  在 comment.js 内加入</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">&lt;script type=&quot;text/javascript&quot;&gt; </span><br><span class="line">(function()&#123; </span><br><span class="line">var appid = &apos;xxxxxxxxxx&apos;; </span><br><span class="line">var conf = &apos;xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx&apos;; </span><br><span class="line">var width = window.innerWidth || document.documentElement.clientWidth; </span><br><span class="line">if (width &lt; 960) &#123; </span><br><span class="line">window.document.write(&apos;&lt;script id=&quot;changyan_mobile_js&quot; charset=&quot;utf-8&quot; type=&quot;text/javascript&quot; src=&quot;https://changyan.sohu.com/upload/mobile/wap-js/changyan_mobile.js?client_id=&apos; + appid + &apos;&amp;conf=&apos; + conf + &apos;&quot;&gt;&lt;\/script&gt;&apos;); &#125; else &#123; var loadJs=function(d,a)&#123;var c=document.getElementsByTagName(&quot;head&quot;)[0]||document.head||document.documentElement;var b=document.createElement(&quot;script&quot;);b.setAttribute(&quot;type&quot;,&quot;text/javascript&quot;);b.setAttribute(&quot;charset&quot;,&quot;UTF-8&quot;);b.setAttribute(&quot;src&quot;,d);if(typeof a===&quot;function&quot;)&#123;if(window.attachEvent)&#123;b.onreadystatechange=function()&#123;var e=b.readyState;if(e===&quot;loaded&quot;||e===&quot;complete&quot;)&#123;b.onreadystatechange=null;a()&#125;&#125;&#125;else&#123;b.onload=a&#125;&#125;c.appendChild(b)&#125;;loadJs(&quot;https://changyan.sohu.com/upload/changyan.js&quot;,function()&#123;window.changyan.api.config(&#123;appid:appid,conf:conf&#125;)&#125;); &#125; &#125;)(); &lt;/script&gt;</span><br></pre></td></tr></table></figure>
<p>  在 getHashCode.js 里面加入 </p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">//获取字符串的 哈希值 </span><br><span class="line">function getHashCode(str,caseSensitive)&#123;</span><br><span class="line">  if(!caseSensitive)&#123;</span><br><span class="line">    str = str.toLowerCase();</span><br><span class="line">  &#125;</span><br><span class="line">  var hash  =   1315423911,i,ch;</span><br><span class="line">  for (i = str.length - 1; i &gt;= 0; i--) &#123;</span><br><span class="line">    ch = str.charCodeAt(i);</span><br><span class="line">    hash ^= ((hash &lt;&lt; 5) + ch + (hash &gt;&gt; 2));</span><br><span class="line">  &#125;</span><br><span class="line">  return  (hash &amp; 0x7FFFFFFF);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">var SOHUCS = document.getElementById(&quot;SOHUCS&quot;);</span><br><span class="line">var hashData = SOHUCS.getAttribute(&quot;hash&quot;);</span><br><span class="line">SOHUCS.setAttribute(&quot;sid&quot;, getHashCode(hashData));</span><br></pre></td></tr></table></figure>
<p>将获取哈希值的方法添加到 sid的属性值里</p>
<p>  在 post.pug 最下面 引入 comment.pug 。post.pug 是文章详情页面， 也就是文章详情页面才会显示评论。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">extends includes/layout.pug</span><br><span class="line"></span><br><span class="line">block content</span><br><span class="line">  article#post</span><br><span class="line">    a.article-title= page.title || &apos;No Title&apos;</span><br><span class="line">    span(id=&quot;busuanzi_container_page_pv&quot; class=&quot;article-traffic&quot;)</span><br><span class="line">      |本文阅读量 </span><br><span class="line">      span(id=&quot;busuanzi_value_page_pv&quot;)</span><br><span class="line">      | &amp;nbsp次</span><br><span class="line">    br</span><br><span class="line">    time.article-date #[i(class=&quot;fa fa-calendar&quot; aria-hidden=&quot;true&quot;)] !&#123;date(page.date, config.date_format)&#125;</span><br><span class="line">    != page.content</span><br><span class="line">  include includes/pagination.pug</span><br><span class="line">  include includes/comment.pug</span><br></pre></td></tr></table></figure>
<p>  在主题下的 _config.yml 的配置文件里面添加代码，否则生成页面的时候不会引入这3个js文件， 代码如下：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">comment:</span><br><span class="line">  js:</span><br><span class="line">    common: /blogs/js/comment/common.js</span><br><span class="line">    getHashCode: /blogs/js/comment/getHashCode.js</span><br><span class="line">    commemt: /blogs/js/comment/comment.js</span><br></pre></td></tr></table></figure>
<p>地址以自己部署博客的地址为准， 比如我生成的页面都部署在 www.shyboy.cc/blogs 文件夹下。所以就是 /blogs/js/comment/xxx.js</p>
<p>至此就大功告成啦，点击文章，下面应该会有畅言的评论出现。 如想修改主题，就在 common.js 加入如下代码：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">var _config=&#123;</span><br><span class="line">  skin: &apos;black&apos; /*黑色皮肤，目前只支持black参数*/</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</div><div class="article-footer"><a class="article-more" href="/blogs/pug如何加入畅言评论功能.html#more">more>></a><div class="article-tags"><i class="fa fa-tag" aria-hidden="true"></i><a class="article-tag" href="/blogs/tags/#hexo">hexo</a><a class="article-tag" href="/blogs/tags/#畅言">畅言</a></div></div></div><nav id="pagination"><div class="pagination"><span class="page-number current">1</span></div></nav></div></div><footer><div id="footer-inner"><div class="social-icons"><a class="social-icon" href="http://shyboy.cc/archives/2018/index.html" target="_blank"><i class="fa fa-undefined"></i></a></div><p class="copyright">Copyright © yaco Blog 2018</p></div></footer><script src="/blogs/js/nav.js"></script><script src="/blogs/js/scroll.js"></script><script src="/blogs/js/index.js"></script></body></html>